import{z as e,q as t,l as a,m as o,A as n,s as l,o as s,c as r,w as c,i as d,a as i,j as m,t as u,f,h as g,F as h,r as p,I as _,x as w,y as S}from"./index-a62d1839.js";import{_ as y}from"./uni-icons.e66cfeb5.js";import{r as b}from"./uni-app.es.4388576a.js";import{_ as k}from"./uni-th.b2e6a484.js";import{_ as x,a as D,b as I}from"./uni-table.06e02d8e.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";const v=T({data:()=>({causeList:[],stuid:sessionStorage.getItem("stuid"),name:sessionStorage.getItem("name"),class:sessionStorage.getItem("classs"),total:70,time:"",nowdata:"",sendinfo:[]}),methods:{back(){e({url:"/pages/admin/index"})},getDate(){const e=(new Date).getFullYear(),t=(new Date).getMonth()+1<10?"0"+((new Date).getMonth()+1):(new Date).getMonth()+1,a=(new Date).getDate()<10?"0"+(new Date).getDate():(new Date).getDate();this.time=e+"-"+t+"-"+a,this.nowdata=e+"年"+t+"月"+a+"日"},addScore(e){var l=e.detail.value;if(""==l.cause)t({title:"请输入加减分原因",icon:"error"});else if(""==l.score)t({title:"请输入加减分数",icon:"error"});else if(l.score>=20)t({title:"一次最多加减20分",icon:"error"});else{let e=sessionStorage.getItem("username");l.score>0?a({url:o().globalData.baseUrl+"/addscore ",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:l.stuid,classs:l.class,name:l.name,cause:l.cause,score:l.score,date:l.date,who:e+"-"+l.nowdata},success:s=>{20401==s.data.code?t({title:"暂无加分权限",icon:"error"}):a({url:o().globalData.baseUrl+"/pl",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:l.stuid,score:l.score},success:s=>{t({title:"加分成功",icon:"success"});let r=1*l.score+1*l.total;a({url:o().globalData.wxSend,method:"POST",data:{msgtype:"markdown",markdown:{content:'德育分变更通知\n><font color="comment">班级:</font>**'+l.class+'**\n><font color="comment">姓名:</font>'+l.name+'\n><font color="comment">通报日期:</font>'+l.date+'\n><font color="comment">加分原因:</font>'+l.cause+'\n><font color="comment">加德育分:</font><font color="info">'+l.score+'</font>\n><font color="comment">总德育分:</font>'+r+'\n><font color="comment">溯源:</font>'+e}}}),setTimeout((()=>{n({url:"/pages/admin/admin"})}),1e3)}})}}):l.score<0&&a({url:o().globalData.baseUrl+"/deletescore ",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:l.stuid,classs:l.class,name:l.name,cause:l.cause,score:l.score,date:l.date,who:e+"-"+l.nowdata},success:s=>{20401==s.data.code?t({title:"暂无减分权限",icon:"error"}):a({url:o().globalData.baseUrl+"/pl",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:l.stuid,score:l.score},success:s=>{t({title:"减分成功",icon:"success"});let r=1*l.score+1*l.total;a({url:o().globalData.wxSend,method:"POST",data:{msgtype:"markdown",markdown:{content:'德育分变更通知\n><font color="comment">班级:</font>**'+l.class+'**\n><font color="comment">姓名:</font>'+l.name+'\n><font color="comment">通报日期:</font>'+l.date+'\n><font color="comment">减分原因:</font>'+l.cause+'\n><font color="comment">减德育分:</font><font color="warning">'+l.score+'</font>\n><font color="comment">总德育分:</font>'+r+'\n><font color="comment">溯源:</font>'+e}}}),setTimeout((()=>{n({url:"/pages/admin/admin"})}),1e3)}})}})}},deleteScore(e){let l=localStorage.getItem("total"),s=sessionStorage.getItem("username"),r=e.score;r>0?a({url:o().globalData.baseUrl+"/delete/"+e.id,method:"DELETE",header:{token:localStorage.getItem("token")},success:c=>{20401==c.data.code?t({title:"无删除权限",icon:"error"}):a({url:o().globalData.baseUrl+"/change",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:e.stuid,score:-1*r+1*l},success:l=>{localStorage.removeItem("total"),t({title:"删除成功",icon:"success"}),a({url:o().globalData.wxSend,method:"POST",data:{msgtype:"markdown",markdown:{content:'已加德育分<font color="warning">**删除**</font>通知\n><font color="comment">班级:</font>'+sessionStorage.getItem("classs")+'\n><font color="comment">姓名:</font>'+e.name+'\n><font color="comment">通报日期:</font>'+e.date+'\n><font color="comment">加分原因:</font>'+e.cause+'\n><font color="comment">加德育分:</font>'+e.score+'\n><font color="comment">删除人:</font>'+s}}}),setTimeout((()=>{n({url:"/pages/admin/admin"})}),1e3)}})}}):r<0&&a({url:o().globalData.baseUrl+"/delete/"+e.id,method:"DELETE",header:{token:localStorage.getItem("token")},success:c=>{20401==c.data.code?t({title:"无删除权限",icon:"error"}):a({url:o().globalData.baseUrl+"/change",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:e.stuid,score:-1*r+1*l},success:l=>{localStorage.removeItem("total"),t({title:"删除成功",icon:"success"}),a({url:o().globalData.wxSend,method:"POST",data:{msgtype:"markdown",markdown:{content:'已减德育分<font color="warning">**删除**</font>通知\n><font color="comment">班级:</font>'+sessionStorage.getItem("classs")+'\n><font color="comment">姓名:</font>'+e.name+'\n><font color="comment">通报日期:</font>'+e.date+'\n><font color="comment">减分原因:</font>'+e.cause+'\n><font color="comment">减德育分:</font>'+e.score+'\n><font color="comment">删除人:</font>'+s}}}),setTimeout((()=>{n({url:"/pages/admin/admin"})}),1e3)},fail:()=>{localStorage.removeItem("total"),t({title:"删除失败",icon:"fail"}),setTimeout((()=>{n({url:"/pages/admin/admin"})}),1e3)}})}})}},onLoad(e){let n=sessionStorage.getItem("stuid");this.getDate(),this.stuInfo=e,a({url:o().globalData.baseUrl+"/adfindcause/"+n,method:"GET",header:{token:localStorage.getItem("token")},success:e=>{if(20401==e.data.code)t({title:"Token失效，重新登陆",icon:"error"}),setTimeout((()=>{l({url:"/pages/login"})}),1e3);else{this.causeList=e.data;for(var a,o=e.data,n=70,s=0;s<o.length;s++)o[s].date.length>10&&(o[s].date=o[s].date.substring(0,10));for(s=o.length-1;s>=0;s--)n+=+o[s].score,this.total=n;localStorage.setItem("total",n);for(let e=0;e<o.length/2;e++)a=o[e],o[e]=o[o.length-1-e],o[o.length-1-e]=a;this.causeList=o}}})}},[["render",function(e,t,a,o,n,l){const T=b(p("uni-icons"),y),v=d,O=b(p("uni-th"),k),P=b(p("uni-tr"),x),U=b(p("uni-td"),D),j=b(p("uni-table"),I),z=_,E=w,L=S;return s(),r(v,null,{default:c((()=>[i(v,{class:"fab",onClick:l.back},{default:c((()=>[i(T,{type:"undo-filled",size:"30",color:"#fff"})])),_:1},8,["onClick"]),i(j,{border:"",stripe:"",emptyText:"暂无更多数据"},{default:c((()=>[i(P,null,{default:c((()=>[i(O,{align:"center",width:"60"},{default:c((()=>[m("学号")])),_:1}),i(O,{align:"center",width:"70"},{default:c((()=>[m("姓名")])),_:1}),i(O,{align:"center",width:"120"},{default:c((()=>[m("班级")])),_:1}),i(O,{align:"center",width:"70"},{default:c((()=>[m("德育分")])),_:1})])),_:1}),i(P,null,{default:c((()=>[i(U,{align:"center"},{default:c((()=>[m(u(n.stuid),1)])),_:1}),i(U,{align:"center"},{default:c((()=>[m(u(n.name),1)])),_:1}),i(U,{align:"center"},{default:c((()=>[m(u(n.class),1)])),_:1}),i(U,{align:"center",id:n.total>=90?"green":n.total>=70?"blue":n.total>=60?"orange":"red",style:{"font-weight":"700","font-size":"40rpx"}},{default:c((()=>[m(u(n.total),1)])),_:1},8,["id"])])),_:1})])),_:1}),i(L,{action:"",onSubmit:l.addScore},{default:c((()=>[i(j,{border:"",stripe:"",emptyText:"暂无更多数据",style:{margin:"50rpx 0 50rpx 0"}},{default:c((()=>[i(P,null,{default:c((()=>[i(O,{align:"center",width:"90"},{default:c((()=>[m("通报日期")])),_:1}),i(O,{align:"center",style:{flex:"1"}},{default:c((()=>[m("加减分原因")])),_:1}),i(O,{align:"center",width:"80"},{default:c((()=>[m("加减分数")])),_:1}),i(O,{align:"center",width:"50"},{default:c((()=>[m("操作")])),_:1})])),_:1}),i(P,null,{default:c((()=>[i(U,{align:"center"},{default:c((()=>[i(z,{type:"text",value:n.time,name:"date",style:{"font-size":"12px"}},null,8,["value"])])),_:1}),i(U,{align:"center"},{default:c((()=>[i(z,{type:"text",name:"cause"})])),_:1}),i(U,{align:"center"},{default:c((()=>[i(z,{type:"text",name:"score"})])),_:1}),i(U,{align:"center",style:{display:"none"}},{default:c((()=>[i(z,{type:"text",name:"name",value:n.name},null,8,["value"])])),_:1}),i(U,{align:"center",style:{display:"none"}},{default:c((()=>[i(z,{type:"text",name:"class",value:n.class},null,8,["value"])])),_:1}),i(U,{align:"center",style:{display:"none"}},{default:c((()=>[i(z,{type:"text",name:"stuid",value:n.stuid},null,8,["value"])])),_:1}),i(U,{align:"center",style:{display:"none"}},{default:c((()=>[i(z,{type:"text",name:"total",value:n.total},null,8,["value"])])),_:1}),i(U,{align:"center",style:{display:"none"}},{default:c((()=>[i(z,{type:"text",name:"nowdata",value:n.nowdata},null,8,["value"])])),_:1}),i(U,{align:"center"},{default:c((()=>[i(E,{type:"primary","form-type":"submit",style:{width:"60px",height:"30px","font-size":"12px"}},{default:c((()=>[m("添加")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"]),i(L,{action:""},{default:c((()=>[i(j,{border:"",stripe:"",emptyText:"暂无更多数据"},{default:c((()=>[i(P,null,{default:c((()=>[i(O,{align:"center",width:"100"},{default:c((()=>[m("通报日期")])),_:1}),i(O,{align:"center",style:{flex:"1"}},{default:c((()=>[m("加减分原因")])),_:1}),i(O,{align:"center",width:"50"},{default:c((()=>[m("分数")])),_:1}),i(O,{align:"center",width:"90"},{default:c((()=>[m("操作")])),_:1})])),_:1}),(s(!0),f(h,null,g(n.causeList,((e,t)=>(s(),r(P,{key:e.id},{default:c((()=>[i(U,{align:"center"},{default:c((()=>[m(u(e.date),1)])),_:2},1024),i(U,{align:"center",style:{"font-size":"24rpx"}},{default:c((()=>[m(u(e.cause),1)])),_:2},1024),i(U,{align:"center",name:"score",id:e.score>0?"green":"red",style:{"font-size":"30rpx","font-weight":"700"}},{default:c((()=>[m(u(e.score),1)])),_:2},1032,["id"]),i(U,{align:"center"},{default:c((()=>[i(E,{type:"warn",size:"mini","form-type":"submit",onClick:t=>l.deleteScore(e)},{default:c((()=>[m("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-a0ff9cf9"]]);export{v as default};
