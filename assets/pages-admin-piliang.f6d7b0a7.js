import{q as e,l as t,m as a,p as s,s as l,o,c as r,w as n,i,a as c,j as d,f as u,h as m,F as f,r as g,I as h,x as p,y as _,t as b}from"./index-a62d1839.js";import{_ as D}from"./uni-search-bar.d4e0d5c9.js";import{r as y}from"./uni-app.es.4388576a.js";import{_ as w}from"./uni-th.b2e6a484.js";import{_ as x,a as S,b as k}from"./uni-table.06e02d8e.js";import{_ as T}from"./uni-icons.e66cfeb5.js";import{_ as j}from"./_plugin-vue_export-helper.1b428a4d.js";const A=j({data:()=>({stuList:[],total:70,time:"",nowdata:"",sendinfo:[],selectDataArr:[],allStu:[]}),methods:{reset(){let e=this.allStu;this.stuList=e},selectionChange(e){for(var t=e.detail.index,a=[],s=0;s<t.length;s++)a[s]=this.stuList[t[s]];this.selectDataArr=a},getDate(){const e=(new Date).getFullYear(),t=(new Date).getMonth()+1<10?"0"+((new Date).getMonth()+1):(new Date).getMonth()+1,a=(new Date).getDate()<10?"0"+(new Date).getDate():(new Date).getDate();this.time=e+"-"+t+"-"+a,this.nowdata=e+"年"+t+"月"+a+"日"},addScore(l){var o=l.detail.value;if(""==o.cause)e({title:"请输入加减分原因",icon:"error"});else if(""==o.score)e({title:"请输入加减分数",icon:"error"});else if(0==this.selectDataArr.length)e({title:"未选择学生",icon:"error"});else if(o.score>=20)e({title:"一次最多加减20分",icon:"error"});else{let l=localStorage.getItem("username");for(var r=0;r<this.selectDataArr.length;r++)if(o.score>0){let n=this.selectDataArr[r].stuid;t({url:a().globalData.baseUrl+"/addscore ",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:this.selectDataArr[r].stuid,classs:this.selectDataArr[r].classs,name:this.selectDataArr[r].name,cause:o.cause,score:o.score,date:o.date,who:l+"_"+this.nowdata},success:l=>{20401==l.data.code?e({title:"无批量加分权限",icon:"error"}):t({url:a().globalData.baseUrl+"/pl",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:n,score:o.score},success:t=>{e({title:"批量加分成功",icon:"success"}),setTimeout((()=>{s({url:"/pages/admin/piliang"})}),1e3)}})}})}else if(o.score<0){let n=this.selectDataArr[r].stuid;t({url:a().globalData.baseUrl+"/deletescore ",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:this.selectDataArr[r].stuid,classs:this.selectDataArr[r].classs,name:this.selectDataArr[r].name,cause:o.cause,score:o.score,date:o.date,who:l+"_"+this.nowdata},success:l=>{20401==l.data.code?e({title:"无批量减分权限",icon:"error"}):t({url:a().globalData.baseUrl+"/pl",method:"POST",header:{token:localStorage.getItem("token")},data:{stuid:n,score:o.score},success:t=>{e({title:"批量减分成功",icon:"success"}),setTimeout((()=>{s({url:"/pages/admin/piliang"})}),1e3)}})}})}var n="";for(r=0;r<this.selectDataArr.length;r++)n+=this.selectDataArr[r].name+" ";t({url:a().globalData.wxSend,method:"POST",data:{msgtype:"markdown",markdown:{content:'批量加减德育分通知\n><font color="comment">姓名:</font>'+n+'\n><font color="comment">通报日期:</font>'+o.date+'\n><font color="comment">加减分原因:</font>'+o.cause+'\n><font color="comment">加减德育分:</font>'+o.score+'\n><font color="comment">溯源:</font>'+l}}})}},tomy(){s({url:"/pages/admin/my"})},tojiajian(){s({url:"/pages/admin/index"})},toexport(){s({url:"/pages/admin/export"})},searchStu(e){for(var t=this.allStu,a=[],s=0,l=0;l<t.length;l++)(t[l].name.includes(e.value)||t[l].classs.includes(e.value))&&(a[s]=t[l],s++);this.stuList=a},getInfo(){let s=localStorage.getItem("token");t({url:a().globalData.baseUrl+"/adfindscore",method:"GET",header:{token:s},success:t=>{20401==t.data.code&&(e({title:"Token过期",icon:"error"}),setTimeout((()=>{l({url:"/pages/login"})}),1e3)),200==t.statusCode?(this.stuList=t.data,this.allStu=t.data):(e({title:"Token过期",icon:"error"}),setTimeout((()=>{l({url:"/pages/login"})}),1e3))}})}},onLoad(){this.getInfo(),this.getDate()}},[["render",function(e,t,a,s,l,j){const A=y(g("uni-search-bar"),D),C=y(g("uni-th"),w),v=y(g("uni-tr"),x),I=h,E=y(g("uni-td"),S),L=p,z=y(g("uni-table"),k),O=_,P=i,U=y(g("uni-icons"),T);return o(),r(P,null,{default:n((()=>[c(A,{onConfirm:j.searchStu,onClear:t[0]||(t[0]=e=>j.reset()),onCancel:t[1]||(t[1]=e=>j.reset()),placeholder:"输入班级或姓名查询",bgColor:"#EEEEEE",textColor:"#fff",style:{"margin-top":"5px"},cancelText:"重置"},null,8,["onConfirm"]),c(O,{action:"",onSubmit:j.addScore},{default:n((()=>[c(z,{border:"",stripe:"",emptyText:"暂无更多数据",style:{margin:"10rpx 0 15px 0"}},{default:n((()=>[c(v,null,{default:n((()=>[c(C,{align:"center",width:"90"},{default:n((()=>[d("通报日期")])),_:1}),c(C,{align:"center",style:{flex:"1"}},{default:n((()=>[d("加减分原因")])),_:1}),c(C,{align:"center",width:"80"},{default:n((()=>[d("加减分数")])),_:1}),c(C,{align:"center",width:"50"},{default:n((()=>[d("操作")])),_:1})])),_:1}),c(v,null,{default:n((()=>[c(E,{align:"center"},{default:n((()=>[c(I,{type:"text",value:l.time,name:"date",style:{"font-size":"12px"}},null,8,["value"])])),_:1}),c(E,{align:"center"},{default:n((()=>[c(I,{type:"text",name:"cause"})])),_:1}),c(E,{align:"center"},{default:n((()=>[c(I,{type:"text",name:"score"})])),_:1}),c(E,{align:"center"},{default:n((()=>[c(L,{type:"primary","form-type":"submit",style:{width:"60px",height:"30px","font-size":"12px"}},{default:n((()=>[d("添加")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"]),c(z,{border:"",stripe:"",emptyText:"查不到信息,请联系秘书部!",class:"table",type:"selection",onSelectionChange:j.selectionChange,style:{width:"100vw"}},{default:n((()=>[c(v,null,{default:n((()=>[c(C,{align:"center",width:"55"},{default:n((()=>[d("学号")])),_:1}),c(C,{align:"center",width:"70"},{default:n((()=>[d("姓名")])),_:1}),c(C,{align:"center",width:"100"},{default:n((()=>[d("班级")])),_:1}),c(C,{align:"center",width:"50"},{default:n((()=>[d("分数")])),_:1})])),_:1}),(o(!0),u(f,null,m(l.stuList,((e,t)=>(o(),r(v,{key:e.id},{default:n((()=>[c(E,{align:"center"},{default:n((()=>[d(b(e.stuid),1)])),_:2},1024),c(E,{align:"center"},{default:n((()=>[d(b(e.name),1)])),_:2},1024),c(E,{align:"center"},{default:n((()=>[d(b(e.classs),1)])),_:2},1024),c(E,{align:"center",id:e.score>=90?"green":e.score>=80?"blue":e.score>=70?"black":e.score>=60?"orange":"red"},{default:n((()=>[d(b(e.score),1)])),_:2},1032,["id"])])),_:2},1024)))),128))])),_:1},8,["onSelectionChange"]),c(P,{class:"",style:{height:"55px"}}),c(P,{class:"tabbar x",style:{"justify-content":"space-around","align-items":"center"}},{default:n((()=>[c(P,{class:"tabitem",style:{},onClick:t[2]||(t[2]=e=>j.tojiajian())},{default:n((()=>[c(U,{type:"bars",size:"25"}),c(P,{class:""},{default:n((()=>[d(" 加减分 ")])),_:1})])),_:1}),c(P,{class:"tabitem",style:{}},{default:n((()=>[c(U,{type:"list",size:"25",color:"#1296db"}),c(P,{class:"",style:{color:"#1296db"}},{default:n((()=>[d(" 批量加减分 ")])),_:1})])),_:1}),c(P,{class:"tabitem",onClick:t[3]||(t[3]=e=>j.toexport())},{default:n((()=>[c(U,{type:"download",size:"25"}),c(P,{class:""},{default:n((()=>[d(" 导出 ")])),_:1})])),_:1}),c(P,{class:"tabitem",onClick:t[4]||(t[4]=e=>j.tomy())},{default:n((()=>[c(U,{type:"person",size:"25"}),c(P,{class:""},{default:n((()=>[d(" 我的 ")])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-08710777"]]);export{A as default};
