import{D as e,E as t,r as s,o as a,c as l,w as i,f as o,t as c,e as r,a as n,n as u,j as h,G as d,F as f,h as m,i as p,k as _,S as y,p as g,C as x,l as b,m as C,q as v,s as k,I as w,x as L,y as D}from"./index-a62d1839.js";import{_ as S}from"./uni-search-bar.d4e0d5c9.js";import{r as j}from"./uni-app.es.4388576a.js";import{W as I}from"./uni-cloud.es.8c8387e1.js";import{_ as z}from"./uni-icons.e66cfeb5.js";import{_ as E}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as T}from"./uni-th.b2e6a484.js";import{_ as V,a as R,b as K}from"./uni-table.06e02d8e.js";import"https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js";const X=E({name:"uni-data-select",mixins:[I.mixinDatacom||{}],props:{localdata:{type:Array,default:()=>[]},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""}},data:()=>({showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[],cacheKey:"uni-data-select-lastSelectedValue"}),created(){this.debounceGet=this.debounce((()=>{this.query()}),300),this.collection&&!this.localdata.length&&this.debounceGet()},computed:{typePlaceholder(){const e=this.placeholder,t={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"}[this.collection];return t?e+t:e},valueCom(){return this.modelValue}},watch:{localdata:{immediate:!0,handler(e,t){Array.isArray(e)&&t!==e&&(this.mixinDatacomResData=e)}},valueCom(e,t){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{debounce(e,t=100){let s=null;return function(...a){s&&clearTimeout(s),s=setTimeout((()=>{e.apply(this,a)}),t)}},query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.debounceGet()},initDefVal(){let e="";if(!this.valueCom&&0!==this.valueCom||this.isDisabled(this.valueCom)){let t;if(this.collection&&(t=this.getCache()),t||0===t)e=t;else{let t="";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(t=this.mixinDatacomResData[this.defItem-1].value),e=t}(e||0===e)&&this.emit(e)}else e=this.valueCom;const t=this.mixinDatacomResData.find((t=>t.value===e));this.current=t?this.formatItemName(t):""},isDisabled(e){let t=!1;return this.mixinDatacomResData.forEach((s=>{s.value===e&&(t=s.disable)})),t},clearVal(){this.emit(""),this.collection&&this.removeCache()},change(e){e.disable||(this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value))},emit(e){this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.collection&&this.setCache(e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:t,value:s,channel_code:a}=e;if(a=a?`(${a})`:"",this.format){let t="";t=this.format;for(let s in e)t=t.replace(new RegExp(`{${s}}`,"g"),e[s]);return t}return this.collection.indexOf("app-list")>0?`${t}(${s})`:t||`未命名${a}`},getLoadData(){return this.mixinDatacomResData},getCurrentCacheKey(){return this.collection},getCache(t=this.getCurrentCacheKey()){return(e(this.cacheKey)||{})[t]},setCache(s,a=this.getCurrentCacheKey()){let l=e(this.cacheKey)||{};l[a]=s,t(this.cacheKey,l)},removeCache(s=this.getCurrentCacheKey()){let a=e(this.cacheKey)||{};delete a[s],t(this.cacheKey,a)}}},[["render",function(e,t,g,x,b,C){const v=p,k=j(s("uni-icons"),z),w=_,L=y;return a(),l(v,{class:"uni-stat__select"},{default:i((()=>[g.label?(a(),o("span",{key:0,class:"uni-label-text hide-on-phone"},c(g.label+"："),1)):r("",!0),n(v,{class:u(["uni-stat-box",{"uni-stat__actived":b.current}])},{default:i((()=>[n(v,{class:u(["uni-select",{"uni-select--disabled":g.disabled}])},{default:i((()=>[n(v,{class:"uni-select__input-box",onClick:C.toggleSelector},{default:i((()=>[b.current?(a(),l(v,{key:0,class:"uni-select__input-text"},{default:i((()=>[h(c(b.current),1)])),_:1})):(a(),l(v,{key:1,class:"uni-select__input-text uni-select__input-placeholder"},{default:i((()=>[h(c(C.typePlaceholder),1)])),_:1})),b.current&&g.clear&&!g.disabled?(a(),l(v,{key:2,onClick:d(C.clearVal,["stop"])},{default:i((()=>[n(k,{type:"clear",color:"#c0c4cc",size:"24"})])),_:1},8,["onClick"])):(a(),l(v,{key:3},{default:i((()=>[n(k,{type:b.showSelector?"top":"bottom",size:"14",color:"#999"},null,8,["type"])])),_:1}))])),_:1},8,["onClick"]),b.showSelector?(a(),l(v,{key:0,class:"uni-select--mask",onClick:C.toggleSelector},null,8,["onClick"])):r("",!0),b.showSelector?(a(),l(v,{key:1,class:"uni-select__selector"},{default:i((()=>[n(v,{class:"uni-popper__arrow"}),n(L,{"scroll-y":"true",class:"uni-select__selector-scroll"},{default:i((()=>[0===b.mixinDatacomResData.length?(a(),l(v,{key:0,class:"uni-select__selector-empty"},{default:i((()=>[n(w,null,{default:i((()=>[h(c(g.emptyTips),1)])),_:1})])),_:1})):(a(!0),o(f,{key:1},m(b.mixinDatacomResData,((e,t)=>(a(),l(v,{class:"uni-select__selector-item",key:t,onClick:t=>C.change(e)},{default:i((()=>[n(w,{class:u({"uni-select__selector__disabled":e.disable})},{default:i((()=>[h(c(C.formatItemName(e)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):r("",!0)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-32096ab0"]]);const $=E({data:()=>({allStu:[],stuList:[],seaechList:[],sendinfo:[],value:"",clas:"信息工程学院",range:[{value:0,text:"<"},{value:1,text:"="},{value:2,text:">"},{value:3,text:"<="},{value:4,text:">="}]}),methods:{tojiajian(){g({url:"/pages/admin/index"})},topiliang(){g({url:"/pages/admin/piliang"})},tomy(){g({url:"/pages/admin/my"})},searchStu(e){this.clas=e.value;for(var t=this.allStu,s=[],a=0,l=0;l<t.length;l++)(t[l].name.includes(e.value)||t[l].classs.includes(e.value))&&(s[a]=t[l],a++);this.stuList=s.sort(((e,t)=>t.score-e.score)),this.seaechList=s.sort(((e,t)=>t.score-e.score))},fliter(e){var t=this.value,s=e.detail.value.score;this.clas;var a=this.stuList;if(0==t){var l=a.filter((function(e){return e.score<s}));this.stuList=l.sort(((e,t)=>t.score-e.score))}else if(1==t){l=a.filter((function(e){return e.score==s}));this.stuList=l.sort(((e,t)=>t.score-e.score))}else if(2==t){l=a.filter((function(e){return e.score>s}));this.stuList=l.sort(((e,t)=>t.score-e.score))}else if(3==t){l=a.filter((function(e){return e.score<=s}));this.stuList=l.sort(((e,t)=>t.score-e.score))}else if(4==t){l=a.filter((function(e){return e.score>=s}));this.stuList=l.sort(((e,t)=>t.score-e.score))}},selectchage(e){let t=this.seaechList;this.num=e,this.stuList=t},reset(){let e=this.seaechList;this.stuList=e},resetsearch(){let e=this.allStu;this.stuList=e,this.seaechList=e,this.clas="信息工程学院"},sx(){let e=this.stuList;this.stuList=e.sort(((e,t)=>e.score-t.score))},jx(){let e=this.stuList;this.stuList=e.sort(((e,t)=>t.score-e.score))},pjf(){let e=this.seaechList,t=this.clas,s=0;for(var a=0;a<e.length;a++)s+=1*+e[a].score;s=(s/e.length).toFixed(2),x({title:"平均分",content:t+"德育平均分:"+s+"分",showCancel:!1,confirmText:"确定",confirmColor:"#00aaff",cancelColor:"#ff0000",success:function(e){e.confirm||e.cancel}})},getInfo(){let e=localStorage.getItem("token");b({url:C().globalData.baseUrl+"/adfindscore",method:"GET",header:{token:e},success:e=>{20401==e.data.code&&(v({title:"Token过期",icon:"error"}),setTimeout((()=>{k({url:"/pages/login"})}),1e3)),200==e.statusCode?(this.stuList=e.data,this.allStu=e.data,this.seaechList=e.data,this.exclass()):(v({title:"Token过期",icon:"error"}),setTimeout((()=>{k({url:"/pages/login"})}),1e3))}})},exclass(){let e=this.stuList.filter(((e,t,s)=>s.findIndex((t=>t.classs===e.classs))===t)),t=[];e.map((e=>{let s={text:e.classs};t.push(s)})),this.selectClass=t.sort(((e,t)=>t.text-e.text))},exportXlsx(){let e=this.clas+"德育分.xlsx",t=this.clas,s=this.stuList,a=[];a.push(["学号","姓名","班级","德育分"]),s.forEach((e=>{let t=[];t.push(e.stuid),t.push(e.name),t.push(e.classs),t.push(e.score),a.push(t)}));var l=XLSX.utils.aoa_to_sheet(a),i=XLSX.utils.book_new();XLSX.utils.book_append_sheet(i,l,t),XLSX.writeFile(i,e)}},onLoad(){this.getInfo()}},[["render",function(e,t,r,u,d,_){const y=j(s("uni-search-bar"),S),g=p,x=j(s("uni-data-select"),X),b=w,C=L,v=D,k=j(s("uni-th"),T),I=j(s("uni-tr"),V),E=j(s("uni-td"),R),$=j(s("uni-table"),K),N=j(s("uni-icons"),z);return a(),l(g,null,{default:i((()=>[n(y,{onConfirm:_.searchStu,onClear:t[0]||(t[0]=e=>_.resetsearch()),onCancel:t[1]||(t[1]=e=>_.resetsearch()),placeholder:"输入班级筛选德育分",bgColor:"#EEEEEE",textColor:"#fff",style:{"margin-top":"5px"},cancelText:"重置"},null,8,["onConfirm"]),n(v,{action:"",onSubmit:_.fliter},{default:i((()=>[n(g,{class:"fliter x",style:{height:"5vh","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},{default:i((()=>[n(g,{class:"x",style:{"justify-content":"space-around","align-items":"center","text-align":"center",width:"55vw"}},{default:i((()=>[n(g,{class:"",style:{"font-size":"13px"}},{default:i((()=>[h("分数")])),_:1}),n(g,{class:"",style:{width:"20vw"}},{default:i((()=>[n(x,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),localdata:d.range,onChange:_.selectchage,style:{"background-color":"#fff"}},null,8,["modelValue","localdata","onChange"])])),_:1}),n(g,{class:"",style:{}},{default:i((()=>[n(b,{type:"number",name:"score",id:"",placeholder:"输入分数",style:{border:"1px solid #c7c7c7","border-radius":"5px",width:"80px",height:"30px","background-color":"#fff","font-size":"13px"}})])),_:1})])),_:1}),n(g,{class:"x",style:{width:"40vw"}},{default:i((()=>[n(C,{type:"primary","form-type":"submit",size:"mini"},{default:i((()=>[h("筛选")])),_:1}),n(C,{type:"warn",onClick:t[3]||(t[3]=e=>_.reset()),size:"mini"},{default:i((()=>[h("重置")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"]),n(g,{class:"x",style:{width:"100vw","margin-bottom":"10px"}},{default:i((()=>[n(C,{type:"primary",onClick:t[4]||(t[4]=e=>_.pjf()),size:"mini"},{default:i((()=>[h("平均分")])),_:1}),n(C,{type:"primary",onClick:t[5]||(t[5]=e=>_.sx()),size:"mini"},{default:i((()=>[h("升序")])),_:1}),n(C,{type:"primary",onClick:t[6]||(t[6]=e=>_.jx()),size:"mini"},{default:i((()=>[h("降序")])),_:1})])),_:1}),n($,{border:"",stripe:"",emptyText:"查不到信息,请联系秘书部!",class:"table",style:{width:"100vw"}},{default:i((()=>[n(I,null,{default:i((()=>[n(k,{align:"center",width:"55"},{default:i((()=>[h("学号")])),_:1}),n(k,{align:"center",width:"70"},{default:i((()=>[h("姓名")])),_:1}),n(k,{align:"center",width:"100"},{default:i((()=>[h("班级")])),_:1}),n(k,{align:"center",width:"50"},{default:i((()=>[h("分数")])),_:1})])),_:1}),(a(!0),o(f,null,m(d.stuList,((e,t)=>(a(),l(I,{key:e.id},{default:i((()=>[n(E,{align:"center"},{default:i((()=>[h(c(e.stuid),1)])),_:2},1024),n(E,{align:"center"},{default:i((()=>[h(c(e.name),1)])),_:2},1024),n(E,{align:"center"},{default:i((()=>[h(c(e.classs),1)])),_:2},1024),n(E,{align:"center",id:e.score>=90?"green":e.score>=80?"blue":e.score>=70?"black":e.score>=60?"orange":"red"},{default:i((()=>[h(c(e.score),1)])),_:2},1032,["id"])])),_:2},1024)))),128))])),_:1}),n(C,{style:{position:"fixed",bottom:"80px",left:"0",right:"0",width:"200px","background-color":"#00aaff",color:"#fff"},onClick:t[7]||(t[7]=e=>_.exportXlsx())},{default:i((()=>[h("导出当前页面德育分")])),_:1}),n(g,{class:"",style:{height:"55px"}}),n(g,{class:"tabbar x",style:{"justify-content":"space-around","align-items":"center"}},{default:i((()=>[n(g,{class:"tabitem",style:{},onClick:t[8]||(t[8]=e=>_.tojiajian())},{default:i((()=>[n(N,{type:"bars",size:"25"}),n(g,{class:""},{default:i((()=>[h(" 加减分 ")])),_:1})])),_:1}),n(g,{class:"tabitem",style:{},onClick:t[9]||(t[9]=e=>_.topiliang())},{default:i((()=>[n(N,{type:"list",size:"25"}),n(g,{class:""},{default:i((()=>[h(" 批量加减分 ")])),_:1})])),_:1}),n(g,{class:"tabitem"},{default:i((()=>[n(N,{type:"download",size:"25",color:"#1296db"}),n(g,{class:"",style:{color:"#1296db"}},{default:i((()=>[h(" 导出 ")])),_:1})])),_:1}),n(g,{class:"tabitem",onClick:t[10]||(t[10]=e=>_.tomy())},{default:i((()=>[n(N,{type:"person",size:"25"}),n(g,{class:""},{default:i((()=>[h(" 我的 ")])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-4dc4d400"]]);export{$ as default};
